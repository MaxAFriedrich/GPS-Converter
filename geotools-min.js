function GT_OSGB(){this.northings=0,this.eastings=0,this.status="Undefined"}function GT_WGS84(){this.latitude=0,this.longitude=0}function GT_Math(){}GT_OSGB.prefixes=new Array(new Array("SV","SW","SX","SY","SZ","TV","TW"),new Array("SQ","SR","SS","ST","SU","TQ","TR"),new Array("SL","SM","SN","SO","SP","TL","TM"),new Array("SF","SG","SH","SJ","SK","TF","TG"),new Array("SA","SB","SC","SD","SE","TA","TB"),new Array("NV","NW","NX","NY","NZ","OV","OW"),new Array("NQ","NR","NS","NT","NU","OQ","OR"),new Array("NL","NM","NN","NO","NP","OL","OM"),new Array("NF","NG","NH","NJ","NK","OF","OG"),new Array("NA","NB","NC","ND","NE","OA","OB"),new Array("HV","HW","HX","HY","HZ","JV","JW"),new Array("HQ","HR","HS","HT","HU","JQ","JR"),new Array("HL","HM","HN","HO","HP","JL","JM")),GT_OSGB.prototype.setGridCoordinates=function(t,a){this.northings=a,this.eastings=t,this.status="OK"},GT_OSGB.prototype.setError=function(t){this.status=t},GT_OSGB.prototype._zeropad=function(t,a){for(var h=new String(t);h.length<a;)h="0"+h;return h},GT_OSGB.prototype.getGridRef=function(t){t<0&&(t=0),t>5&&(t=5);var a="",h="";if(t>0){var o=Math.floor(this.northings/1e5),n=Math.floor(this.eastings/1e5),M=(a=Math.round(this.eastings%1e5),h=Math.round(this.northings%1e5),5-t);a=Math.round(a/Math.pow(10,M)),h=Math.round(h/Math.pow(10,M))}return GT_OSGB.prefixes[o][n]+" "+this._zeropad(a,t)+" "+this._zeropad(h,t)},GT_OSGB.prototype.parseGridRef=function(t){var a,h=!1;for(this.northings=0,this.eastings=0,a=5;a>=1;a--){var o=new RegExp("^([A-Z]{2})\\s*(\\d{"+a+"})\\s*(\\d{"+a+"})$","i"),n=t.match(o);if(n){var M,r,e=n[1],i=0,s=0;if(a>0){var _=Math.pow(10,5-a);i=parseInt(n[2],10)*_,s=parseInt(n[3],10)*_}t:for(r=0;r<GT_OSGB.prefixes.length;r++)for(M=0;M<GT_OSGB.prefixes[r].length;M++)if(GT_OSGB.prefixes[r][M]==e){this.eastings=1e5*M+i,this.northings=1e5*r+s,h=!0;break t}}}return h},GT_OSGB.prototype.getWGS84=function(){var t=GT_Math.E_N_to_Lat(this.eastings,this.northings,6377563.396,6356256.91,4e5,-1e5,.999601272,49,-2),a=GT_Math.E_N_to_Long(this.eastings,this.northings,6377563.396,6356256.91,4e5,-1e5,.999601272,49,-2),h=GT_Math.Lat_Long_H_to_X(t,a,0,6377563.396,6356256.91),o=GT_Math.Lat_Long_H_to_Y(t,a,0,6377563.396,6356256.91),n=GT_Math.Lat_H_to_Z(t,0,6377563.396,6356256.91),M=GT_Math.Helmert_X(h,o,n,446.448,.247,.8421,-20.4894),r=GT_Math.Helmert_Y(h,o,n,-125.157,.1502,.8421,-20.4894),e=GT_Math.Helmert_Z(h,o,n,542.06,.1502,.247,-20.4894),i=GT_Math.XYZ_to_Lat(M,r,e,6378137,6356752.313),s=GT_Math.XYZ_to_Long(M,r),_=new GT_WGS84;return _.setDegrees(i,s),_},GT_WGS84.prototype.setDegrees=function(t,a){this.latitude=t,this.longitude=a},GT_WGS84.prototype.parseString=function(t){var a=!1,h=new String(t).match(/([ns])\s*(\d+)[�\s]+(\d+\.\d+)\s+([we])\s*(\d+)[�\s]+(\d+\.\d+)/i);if(h){a=!0;var o="s"==h[1]||"S"==h[1]?-1:1,n="w"==h[4]||"W"==h[4]?-1:1,M=parseFloat(h[2]),r=parseFloat(h[3]),e=parseFloat(h[5]),i=parseFloat(h[6]);this.latitude=o*(M+r/60),this.longitude=n*(e+i/60)}return a},GT_WGS84.prototype.isGreatBritain=function(){return this.latitude>49&&this.latitude<62&&this.longitude>-9.5&&this.longitude<2.3},GT_WGS84.prototype.isIreland=function(){return this.latitude>51.2&&this.latitude<55.73&&this.longitude>-12.2&&this.longitude<-4.8},GT_WGS84.prototype.getOSGB=function(){var t=new GT_OSGB;if(this.isGreatBritain()){var a=GT_Math.Lat_Long_H_to_X(this.latitude,this.longitude,0,6378137,6356752.313),h=GT_Math.Lat_Long_H_to_Y(this.latitude,this.longitude,0,6378137,6356752.313),o=GT_Math.Lat_H_to_Z(this.latitude,0,6378137,6356752.313),n=GT_Math.Helmert_X(a,h,o,-446.448,-.247,-.8421,20.4894),M=GT_Math.Helmert_Y(a,h,o,125.157,-.1502,-.8421,20.4894),r=GT_Math.Helmert_Z(a,h,o,-542.06,-.1502,-.247,20.4894),e=GT_Math.XYZ_to_Lat(n,M,r,6377563.396,6356256.91),i=GT_Math.XYZ_to_Long(n,M),s=GT_Math.Lat_Long_to_East(e,i,6377563.396,6356256.91,4e5,.999601272,49,-2),_=GT_Math.Lat_Long_to_North(e,i,6377563.396,6356256.91,4e5,-1e5,.999601272,49,-2);t.setGridCoordinates(Math.round(s),Math.round(_))}else t.setError("Coordinate not within Great Britain");return t},GT_Math.E_N_to_Lat=function(t,a,h,o,n,M,r,e,i){var s=3.14159265358979,_=e*(s/180),p=h*r,w=o*r,G=(Math.pow(p,2)-Math.pow(w,2))/Math.pow(p,2),u=(p-w)/(p+w),T=t-n,S=GT_Math.InitialLat(a,M,p,_,u,w),g=p/Math.sqrt(1-G*Math.pow(Math.sin(S),2)),c=g*(1-G)/(1-G*Math.pow(Math.sin(S),2)),f=g/c-1,d=Math.tan(S)/(2*c*g),L=Math.tan(S)/(24*c*Math.pow(g,3))*(5+3*Math.pow(Math.tan(S),2)+f-9*f*Math.pow(Math.tan(S),2)),l=Math.tan(S)/(720*c*Math.pow(g,5))*(61+90*(2^Math.tan(S))+45*Math.pow(Math.tan(S),4));return 180/s*(S-Math.pow(T,2)*d+Math.pow(T,4)*L-(6^T)*l)},GT_Math.E_N_to_Long=function(t,a,h,o,n,M,r,e,i){var s=3.14159265358979,_=e*(s/180),p=i*(s/180),w=h*r,G=o*r,u=(Math.pow(w,2)-Math.pow(G,2))/Math.pow(w,2),T=(w-G)/(w+G),S=t-n,g=GT_Math.InitialLat(a,M,w,_,T,G),c=w/Math.sqrt(1-u*Math.pow(Math.sin(g),2)),f=c*(1-u)/(1-u*Math.pow(Math.sin(g),2)),d=Math.pow(Math.cos(g),-1)/c,L=Math.pow(Math.cos(g),-1)/(6*Math.pow(c,3))*(c/f+2*Math.pow(Math.tan(g),2)),l=Math.pow(Math.cos(g),-1)/(120*Math.pow(c,5))*(5+28*Math.pow(Math.tan(g),2)+24*Math.pow(Math.tan(g),4)),H=Math.pow(Math.cos(g),-1)/(5040*Math.pow(c,7))*(61+662*Math.pow(Math.tan(g),2)+1320*Math.pow(Math.tan(g),4)+720*Math.pow(Math.tan(g),6));return 180/s*(p+S*d-Math.pow(S,3)*L+Math.pow(S,5)*l-Math.pow(S,7)*H)},GT_Math.InitialLat=function(t,a,h,o,n,M){for(var r=(t-a)/h+o,e=GT_Math.Marc(M,n,o,r),i=(t-a-e)/h+r;Math.abs(t-a-e)>1e-5;)i=(t-a-e)/h+r,e=GT_Math.Marc(M,n,o,i),r=i;return i},GT_Math.Lat_Long_H_to_X=function(t,a,h,o,n){var M=3.14159265358979,r=t*(M/180),e=a*(M/180),i=(Math.pow(o,2)-Math.pow(n,2))/Math.pow(o,2);return(o/Math.sqrt(1-i*Math.pow(Math.sin(r),2))+h)*Math.cos(r)*Math.cos(e)},GT_Math.Lat_Long_H_to_Y=function(t,a,h,o,n){var M=3.14159265358979,r=t*(M/180),e=a*(M/180),i=(Math.pow(o,2)-Math.pow(n,2))/Math.pow(o,2);return(o/Math.sqrt(1-i*Math.pow(Math.sin(r),2))+h)*Math.cos(r)*Math.sin(e)},GT_Math.Lat_H_to_Z=function(t,a,h,o){var n=.017453292519943278*t,M=(Math.pow(h,2)-Math.pow(o,2))/Math.pow(h,2);return(h/Math.sqrt(1-M*Math.pow(Math.sin(n),2))*(1-M)+a)*Math.sin(n)},GT_Math.Helmert_X=function(t,a,h,o,n,M,r){var e=3.14159265358979;return t+t*(1e-6*r)-a*(M/3600*(e/180))+h*(n/3600*(e/180))+o},GT_Math.Helmert_Y=function(t,a,h,o,n,M,r){var e=3.14159265358979;return t*(M/3600*(e/180))+a+a*(1e-6*r)-h*(n/3600*(e/180))+o},GT_Math.Helmert_Z=function(t,a,h,o,n,M,r){var e=3.14159265358979;return-1*t*(M/3600*(e/180))+a*(n/3600*(e/180))+h+h*(1e-6*r)+o},GT_Math.XYZ_to_Lat=function(t,a,h,o,n){var M=Math.sqrt(Math.pow(t,2)+Math.pow(a,2)),r=(Math.pow(o,2)-Math.pow(n,2))/Math.pow(o,2),e=Math.atan2(h,M*(1-r));return 57.29577951308238*GT_Math.Iterate_XYZ_to_Lat(o,r,e,h,M)},GT_Math.Iterate_XYZ_to_Lat=function(t,a,h,o,n){for(var M=t/Math.sqrt(1-a*Math.pow(Math.sin(h),2)),r=Math.atan2(o+a*M*Math.sin(h),n);Math.abs(h-r)>1e-9;)h=r,M=t/Math.sqrt(1-a*Math.pow(Math.sin(h),2)),r=Math.atan2(o+a*M*Math.sin(h),n);return r},GT_Math.XYZ_to_Long=function(t,a){return 57.29577951308238*Math.atan2(a,t)},GT_Math.Marc=function(t,a,h,o){return t*((1+a+5/4*Math.pow(a,2)+5/4*Math.pow(a,3))*(o-h)-(3*a+3*Math.pow(a,2)+21/8*Math.pow(a,3))*Math.sin(o-h)*Math.cos(o+h)+(15/8*Math.pow(a,2)+15/8*Math.pow(a,3))*Math.sin(2*(o-h))*Math.cos(2*(o+h))-35/24*Math.pow(a,3)*Math.sin(3*(o-h))*Math.cos(3*(o+h)))},GT_Math.Lat_Long_to_East=function(t,a,h,o,n,M,r,e){var i=3.14159265358979,s=t*(i/180),_=a*(i/180),p=e*(i/180),w=h*M,G=o*M,u=(Math.pow(w,2)-Math.pow(G,2))/Math.pow(w,2),T=w/Math.sqrt(1-u*Math.pow(Math.sin(s),2)),S=T*(1-u)/(1-u*Math.pow(Math.sin(s),2)),g=T/S-1,c=_-p,f=T*Math.cos(s),d=T/6*Math.pow(Math.cos(s),3)*(T/S-Math.pow(Math.tan(s),2)),L=T/120*Math.pow(Math.cos(s),5)*(5-18*Math.pow(Math.tan(s),2)+Math.pow(Math.tan(s),4)+14*g-58*Math.pow(Math.tan(s),2)*g);return n+c*f+Math.pow(c,3)*d+Math.pow(c,5)*L},GT_Math.Lat_Long_to_North=function(t,a,h,o,n,M,r,e,i){var s=3.14159265358979,_=t*(s/180),p=a*(s/180),w=e*(s/180),G=i*(s/180),u=h*r,T=o*r,S=(Math.pow(u,2)-Math.pow(T,2))/Math.pow(u,2),g=(u-T)/(u+T),c=u/Math.sqrt(1-S*Math.pow(Math.sin(_),2)),f=c/(c*(1-S)/(1-S*Math.pow(Math.sin(_),2)))-1,d=p-G,L=GT_Math.Marc(T,g,w,_)+M,l=c/2*Math.sin(_)*Math.cos(_),H=c/24*Math.sin(_)*Math.pow(Math.cos(_),3)*(5-Math.pow(Math.tan(_),2)+9*f),N=c/720*Math.sin(_)*Math.pow(Math.cos(_),5)*(61-58*Math.pow(Math.tan(_),2)+Math.pow(Math.tan(_),4));return L+Math.pow(d,2)*l+Math.pow(d,4)*H+Math.pow(d,6)*N};